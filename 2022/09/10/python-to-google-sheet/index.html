<!doctype html><html lang=en><head><title>將數據由 Python 儲存至 Google Sheet ::
TUSK — Watching things with another angle</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="除住伺服器要更新，寄存係伺服器嘅 tasks 都要搵個地方搬，因為新的地方唔再有 MariaDB 可以用。呢家手頭上有一個 task 係每個鐘都行，係網上爬啲 data 之後執靚寫落 database，INSERT 多而 SELECT 少，集齊一大堆數據再會下載落嚟分析。其實又冇 JOIN 又唔太需要 SQL operation，真係唔需要用到 relational database，花錢開多部機行 Database 就好唔抵。
"><meta name=keywords content="Felix,Blog,Hugo"><meta name=robots content="noodp"><link rel=canonical href=https://hang.swiftzer.net/2022/09/10/python-to-google-sheet/><link rel=stylesheet href=https://hang.swiftzer.net/assets/style.css><link rel=stylesheet href=https://hang.swiftzer.net/style.css><link rel=apple-touch-icon-precomposed sizes=144x144 href=https://hang.swiftzer.net/img/apple-touch-icon-144-precomposed.png><link rel="shortcut icon" href=https://hang.swiftzer.net/img/favicon.png><link href=https://hang.swiftzer.net/assets/fonts/Inter-Italic.woff2 rel=preload type=font/woff2 as=font crossorigin><link href=https://hang.swiftzer.net/assets/fonts/Inter-Regular.woff2 rel=preload type=font/woff2 as=font crossorigin><link href=https://hang.swiftzer.net/assets/fonts/Inter-Medium.woff2 rel=preload type=font/woff2 as=font crossorigin><link href=https://hang.swiftzer.net/assets/fonts/Inter-MediumItalic.woff2 rel=preload type=font/woff2 as=font crossorigin><link href=https://hang.swiftzer.net/assets/fonts/Inter-Bold.woff2 rel=preload type=font/woff2 as=font crossorigin><link href=https://hang.swiftzer.net/assets/fonts/Inter-BoldItalic.woff2 rel=preload type=font/woff2 as=font crossorigin><meta name=twitter:card content="summary"><meta name=twitter:title content="將數據由 Python 儲存至 Google Sheet"><meta name=twitter:description content="除住伺服器要更新，寄存係伺服器嘅 tasks 都要搵個地方搬，因為新的地方唔再有 MariaDB 可以用。呢家手頭上有一個 task 係每個鐘都行，係網上爬啲 data 之後執靚寫落 database，INSERT 多而 SELECT 少，集齊一大堆數據再會下載落嚟分析。其實又冇 JOIN 又唔太需要 SQL operation，真係唔需要用到 relational database，花錢開多部機行 Database 就好唔抵。"><meta property="og:title" content="將數據由 Python 儲存至 Google Sheet"><meta property="og:description" content="除住伺服器要更新，寄存係伺服器嘅 tasks 都要搵個地方搬，因為新的地方唔再有 MariaDB 可以用。呢家手頭上有一個 task 係每個鐘都行，係網上爬啲 data 之後執靚寫落 database，INSERT 多而 SELECT 少，集齊一大堆數據再會下載落嚟分析。其實又冇 JOIN 又唔太需要 SQL operation，真係唔需要用到 relational database，花錢開多部機行 Database 就好唔抵。"><meta property="og:type" content="article"><meta property="og:url" content="https://hang.swiftzer.net/2022/09/10/python-to-google-sheet/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-09-10T11:27:42+08:00"><meta property="article:modified_time" content="2022-09-10T11:27:42+08:00"><meta property="og:site_name" content="TUSK"></head><body class=light-theme><div class=container><header class=header><span class=header__inner><a href=/ class=logo style=text-decoration:none><span class=logo__mark><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" viewBox="0 0 44 44"><path fill="none" d="M15 8l14.729 14.382L15 35.367"/></svg></span><span class=logo__text>TUSK</span>
<span class=logo__cursor></span></a>
<span class=header__right><nav class=menu><ul class="menu__inner menu__inner--desktop"><li><a href=/about>About</a></li><li><a href=/categories>Category</a></li><li><a href=/tags>Tags</a></li><ul class=menu__sub-inner><li class=menu__sub-inner-more-trigger>Show more
<span class=menu__sub-inner-more-trigger-icon><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" viewBox="0 0 44 44"><path fill="none" d="M15 8l14.729 14.382L15 35.367"/></svg></span></li><ul class="menu__sub-inner-more hidden"><li><a href=https://twitter.com/hongkongfelix>Twitter</a></li><li><a href=https://www.flickr.com/felix-chan/>Flickr</a></li></ul></ul></ul><ul class="menu__inner menu__inner--mobile"><li><a href=/about>About</a></li><li><a href=/categories>Category</a></li><li><a href=/tags>Tags</a></li><li><a href=https://twitter.com/hongkongfelix>Twitter</a></li><li><a href=https://www.flickr.com/felix-chan/>Flickr</a></li></ul></nav><span class=menu-trigger><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none"/><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg></span><span class=theme-toggle><svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M22 41c10.4934.0 19-8.5066 19-19C41 11.5066 32.4934 3 22 3 11.5066 3 3 11.5066 3 22s8.5066 19 19 19zM7 22C7 13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22z"/></svg></span></span></span></header><div class=content><div class=post><h1 class=post-title>將數據由 Python 儲存至 Google Sheet</h1><div class=post-meta><span class=post-date>2022-09-10</span>
<span class=post-author>— Written by HaNg~</span></div><span class=post-tags><a href=https://hang.swiftzer.net/tags/python/>#Python</a>&nbsp;
<a href=https://hang.swiftzer.net/tags/google-sheet/>#Google Sheet</a>&nbsp;
<a href=https://hang.swiftzer.net/tags/data/>#Data</a>&nbsp;
<a href=https://hang.swiftzer.net/tags/visualization/>#Visualization</a>&nbsp;</span><div class=post-content><p>除住伺服器要更新，寄存係伺服器嘅 tasks 都要搵個地方搬，因為新的地方唔再有 <a href=https://mariadb.org/ title="MariaDB Foundation">MariaDB</a> 可以用。呢家手頭上有一個 task 係每個鐘都行，係網上爬啲 data 之後執靚寫落 database，<code>INSERT</code> 多而 <code>SELECT</code> 少，集齊一大堆數據再會下載落嚟分析。其實又冇 <code>JOIN</code> 又唔太需要 SQL operation，真係唔需要用到 <a href=https://en.wikipedia.org/wiki/Relational_database title="Relational database">relational database</a>，花錢開多部機行 Database 就好唔抵。</p><p>其間都有考慮過唔同嘅可能性︰</p><ul><li><a href=https://aws.amazon.com/tw/lambda/>AWS Lambda</a> and <a href=https://aws.amazon.com/tw/s3/>AWS S3</a></li><li><a href=https://www.mongodb.com/cloud/atlas/>MongoDB atlas</a></li><li><a href=https://www.digitalocean.com/products/app-platform>DigitalOcean App Platform</a></li><li>New VPS server</li></ul><p>後來，見到有中文 blogger 介紹<a href=https://www.learncodewithmike.com/2020/08/python-write-to-google-sheet.html>解析如何串接Google Sheet試算表寫入爬取的資料</a>，發現佢先係我呢個情況最好嘅替代方案。為左避免對方搬家或者刪除 blog，我決定將重點抄一次落嚟。</p><h3 id=a-啟用金google-sheet-api>A. 啟用金Google Sheet API
<a href=#a-%e5%95%9f%e7%94%a8%e9%87%91google-sheet-api class=h-anchor aria-hidden=true>#</a></h3><ol><li>前住 <a href=https://console.developers.google.com/>Google API Console</a> 並登入 Google Account</li><li>為你的程序 <strong>新增專案</strong></li><li>按 <strong>建立</strong> 完成新增專案</li><li>在 <strong>快速存取</strong> 選擇 <strong>API 和服務</strong></li><li>再選擇 <strong>啟用 API 和服務</strong></li><li>搜索並選擇 <strong>Google Sheets API</strong>，並點擊 <strong>啟用</strong></li></ol><h3 id=b-建立-google-sheets-api-憑證>B. 建立 Google Sheets API 憑證
<a href=#b-%e5%bb%ba%e7%ab%8b-google-sheets-api-%e6%86%91%e8%ad%89 class=h-anchor aria-hidden=true>#</a></h3><ol><li>在 <strong>API 和服務</strong> 中選擇 <strong>憑證</strong></li><li>選擇 <strong>建立憑證</strong></li><li>資料類型選擇 <strong>應用程式資料</strong></li><li>選擇 <strong>不搭配使用</strong> Compute Engine、Kubernetes Engine、App Engine 或 Cloud Functions</li><li>建立一個 <strong>服務帳戶的名稱</strong>，系統會生成一個 email address</li><li>完成後選擇剛才建立的名稱，再按 <strong>金鑰</strong> 新增一個 <code>JSON</code> 檔案予 Python 使用</li></ol><h3 id=c-建立-google-sheet>C. 建立 Google Sheet
<a href=#c-%e5%bb%ba%e7%ab%8b-google-sheet class=h-anchor aria-hidden=true>#</a></h3><ol><li>建立一個全新的 Google Sheet</li><li>在 URL address 中尋找 Google Sheet unique ID</li></ol><ul><li><code>https://docs.google.com/spreadsheets/d/&lt;unique_id>/edit#gid=0</code></li></ul><ol start=3><li>在已下載的 <code>JSON</code> 檔案尋找 email address，並把 Google Sheet 共用予該 email address</li></ol><h3 id=d-將數據提交至-google-sheet>D. 將數據提交至 Google Sheet
<a href=#d-%e5%b0%87%e6%95%b8%e6%93%9a%e6%8f%90%e4%ba%a4%e8%87%b3-google-sheet class=h-anchor aria-hidden=true>#</a></h3><ol><li><p>先安裝所需要的 Python library</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pip install gspread oauth2client
</span></span></code></pre></div></li><li><p>將下載的 <code>JSON</code> 檔案命名為 <code>credentials.json</code></p></li><li><p>在 Python 中置入以下內容，以便寫入 Google Sheet</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> gspread
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> oauth2client.service_account <span style=color:#f92672>import</span> ServiceAccountCredentials
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> datetime <span style=color:#f92672>import</span> date, datetime
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>gsheet</span>(data):
</span></span><span style=display:flex><span>    scopes <span style=color:#f92672>=</span> [<span style=color:#e6db74>&#34;https://spreadsheets.google.com/feeds&#34;</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    credentials <span style=color:#f92672>=</span> ServiceAccountCredentials<span style=color:#f92672>.</span>from_json_keyfile_name(
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;credentials.json&#34;</span>, scopes)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    client <span style=color:#f92672>=</span> gspread<span style=color:#f92672>.</span>authorize(credentials)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    sheet <span style=color:#f92672>=</span> client<span style=color:#f92672>.</span>open_by_key(
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;&lt;unique_id&gt;&#34;</span>)<span style=color:#f92672>.</span>sheet1
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> range(<span style=color:#ae81ff>10</span>):
</span></span><span style=display:flex><span>        sheet<span style=color:#f92672>.</span>append_row((
</span></span><span style=display:flex><span>            datetime<span style=color:#f92672>.</span>now()<span style=color:#f92672>.</span>strftime(<span style=color:#e6db74>&#39;%Y-%m-</span><span style=color:#e6db74>%d</span><span style=color:#e6db74> %H:%M:%S&#39;</span>), 
</span></span><span style=display:flex><span>            data[<span style=color:#e6db74>&#39;col1&#39;</span>], 
</span></span><span style=display:flex><span>            data[<span style=color:#e6db74>&#39;col2&#39;</span>], 
</span></span><span style=display:flex><span>            data[<span style=color:#e6db74>&#39;col3&#39;</span>]
</span></span><span style=display:flex><span>        ))
</span></span></code></pre></div></li><li><p>呼叫 Python function <code>gsheet</code> 新增數據到 Google Sheet</p></li></ol><p>詳情或者想睇圖，可以返回 <a href=https://www.learncodewithmike.com/2020/08/python-write-to-google-sheet.html>Mike</a> 嘅文章了解下。</p></div><div class=pagination><div class=pagination__title><span class=pagination__title-h>Read other posts</span><hr></div><div class=pagination__buttons><span class="button previous"><a href=https://hang.swiftzer.net/2022/11/19/%E5%9F%B7%E7%9B%B8%E6%96%B0%E8%BB%9F%E4%BB%B6_Affinity_Photo/><span class=button__icon>←</span>
<span class=button__text>執相新軟件︰ Affinity Photo</span></a></span>
<span class="button next"><a href=https://hang.swiftzer.net/2022/09/07/migrate_to_hugo/><span class=button__text>更新網誌系統到 Hugo</span>
<span class=button__icon>→</span></a></span></div></div></div></div><footer class=footer><div class=footer__inner><a href=/ class=logo style=text-decoration:none><span class=logo__mark><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" viewBox="0 0 44 44"><path fill="none" d="M15 8l14.729 14.382L15 35.367"/></svg></span><span class=logo__text>TUSK</span>
<span class=logo__cursor></span></a><div class=copyright><span>© 2023 Powered by
<a href=https://gohugo.io target=_blank rel=noopener>Hugo</a></span>
<span>Theme created by
<a href=https://twitter.com/panr target=_blank rel=noopener>panr</a></span></div></div></footer><script src=https://hang.swiftzer.net/assets/main.js></script>
<script src=https://hang.swiftzer.net/assets/prism.js></script></div><script async src="https://www.googletagmanager.com/gtag/js?id=G-J3XEEH0Q63"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-J3XEEH0Q63",{anonymize_ip:!1})}</script></body></html>